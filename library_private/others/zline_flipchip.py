############################################################################################
# File Name: zline_flipchip.py
# Description: This file primarily contains the code for constructing Z-line flip-chip structures.
############################################################################################

import gdspy, copy
from addict import Dict
import math
from base.library_base import LibraryBase


class ZlineFlipchip(LibraryBase):
    default_options = Dict(
        # Framework
        name="coupler0",
        type="Coupler",
        pad_pos=(0, 0),
        pad_width=300,
        pad_height=300,
        finger_length=100,
        path_width=10,
        gap=6,
        finger_corner_radius=30,
        path_corner_radius=90,
        end_start_offset=100,
        end_orientation=45,
        end_length=200,
        end_corner_radius=30,
        finger_orientation=270,
        orientation=270
    )

    def __init__(self, options: Dict = None):
        """
        Initializes an instance of the ZlineFlipchip class.

        Input:
            options: Dict, containing custom option parameters.
        """
        super().__init__(options)
        return

    def calc_general_ops(self):
        """
        Placeholder function for calculating general operations.
        """
        return

    def draw_gds(self):
        """
        Draws the geometric shape of the Z-line flip-chip and adds it to the GDS cell.
        """
        # Drawing
        self.lib = gdspy.GdsLibrary()
        gdspy.library.use_current_library = False
        self.cell = self.lib.new_cell(self.name + "_cell")

        pad_pos = self.pad_pos
        orientation = self.orientation - 270

        points_inner = [(16.074, -72.771), (16.851, -72.656), (17.612, -72.466), (18.351, -72.201), (19.061, -71.865),
                        (19.735, -71.462), (20.365, -70.994), (20.947, -70.467), (21.474, -69.885),
                        (21.942, -69.255), (22.345, -68.581), (22.681, -67.871), (22.946, -67.132), (23.136, -66.371),
                        (23.251, -65.594), (23.290, -64.810), (23.290, -39.220), (23.248, -37.924),
                        (23.122, -36.634), (22.913, -35.355), (22.621, -34.092), (22.249, -32.850), (21.796, -31.635),
                        (21.266, -30.453), (13.776, -15.752), (13.557, -15.229), (13.398, -14.685),
                        (13.302, -14.126), (13.270, -13.560), (13.270, -12.760), (11.270, -12.760), (11.270, -14.010),
                        (11.302, -14.576), (11.398, -15.135), (11.557, -15.679), (11.776, -16.202),
                        (16.580, -25.720), (16.331, -26.021), (16.029, -26.267), (15.684, -26.451), (15.310, -26.564),
                        (14.922, -26.602), (6.000, -26.602), (5.610, -26.563), (5.235, -26.449),
                        (4.889, -26.265), (4.586, -26.016), (4.337, -25.713), (4.152, -25.367), (4.038, -24.992),
                        (4.000, -24.602), (4.000, 0.000), (2.000, 0.000), (2.000, -24.510),
                        (1.962, -24.900), (1.848, -25.275), (1.663, -25.621), (1.414, -25.924), (1.111, -26.173),
                        (0.765, -26.358), (0.390, -26.472), (0.000, -26.510), (-15.010, -26.510),
                        (-15.794, -26.549), (-16.571, -26.664), (-17.332, -26.854), (-18.071, -27.119),
                        (-18.781, -27.455), (-19.455, -27.858), (-20.085, -28.326), (-20.667, -28.853),
                        (-21.194, -29.435),
                        (-21.662, -30.065), (-22.065, -30.739), (-22.401, -31.449), (-22.666, -32.188),
                        (-22.856, -32.949), (-22.971, -33.726), (-23.010, -34.510), (-23.010, -64.810),
                        (-22.971, -65.594),
                        (-22.856, -66.371), (-22.666, -67.132), (-22.401, -67.871), (-22.065, -68.581),
                        (-21.662, -69.255), (-21.194, -69.885), (-20.667, -70.467), (-20.085, -70.994),
                        (-19.455, -71.462),
                        (-18.781, -71.865), (-18.071, -72.201), (-17.332, -72.466), (-16.571, -72.656),
                        (-15.794, -72.771), (-15.010, -72.810), (15.290, -72.810)]

        modify_points_inner = [(x * 2.5, y * 2.5) for x, y in points_inner]
        modify_points_inner = [(x + pad_pos[0], y + pad_pos[1]) for x, y in modify_points_inner]

        poly_inner = gdspy.Polygon(modify_points_inner)

        points_outer = [(16.336, -78.761), (17.377, -78.644), (18.405, -78.449), (19.417, -78.178), (20.405, -77.832),
                        (21.364, -77.414), (22.290, -76.924), (23.176, -76.367), (24.019, -75.746), (24.812, -75.063),
                        (25.553, -74.322), (26.236, -73.529), (26.857, -72.686), (27.414, -71.800), (27.904, -70.874),
                        (28.322, -69.915), (28.668, -68.927), (28.939, -67.915), (29.134, -66.887), (29.251, -65.846),
                        (29.290, -64.800), (29.290, -39.210), (29.248, -37.914), (29.122, -36.624), (28.913, -35.345),
                        (28.621, -34.082), (28.249, -32.840), (27.796, -31.625), (27.266, -30.443), (20.026, -15.752),
                        (19.807, -15.229), (19.648, -14.685), (19.552, -14.126), (19.520, -13.560), (19.520, -12.760),
                        (17.520, -12.760), (17.520, -14.010), (17.552, -14.576), (17.648, -15.135), (17.807, -15.679),
                        (18.026, -16.202), (25.174, -30.471), (25.717, -31.648), (26.182, -32.858), (26.568, -34.095),
                        (26.873, -35.355), (27.096, -36.632), (27.235, -37.921), (27.291, -39.216), (27.291, -64.806),
                        (27.250, -65.797), (27.127, -66.781), (26.924, -67.752), (26.641, -68.702), (26.280, -69.626),
                        (25.845, -70.517), (25.337, -71.369), (24.761, -72.177), (24.120, -72.933), (23.418, -73.635),
                        (22.662, -74.276), (21.854, -74.852), (21.002, -75.360), (20.111, -75.795), (19.187, -76.156),
                        (18.237, -76.439), (17.266, -76.642), (16.282, -76.765), (15.291, -76.806), (-15.009, -76.806),
                        (-16.000, -76.765), (-16.984, -76.642), (-17.955, -76.439), (-18.905, -76.156),
                        (19.829, -75.795), (-20.720, -75.360), (-21.572, -74.852), (-22.380, -74.276),
                        (-23.136, -73.635), (-23.838, -72.933),
                        (-24.479, -72.177), (-25.055, -71.369), (-25.563, -70.517), (-25.998, -69.626),
                        (-26.359, -68.702), (-26.642, -67.752), (-26.845, -66.781), (-26.968, -65.797),
                        (-27.009, -64.806), (-27.009, -34.506),
                        (-26.968, -33.515), (-26.845, -32.531), (-26.642, -31.560), (-26.359, -30.610),
                        (-25.998, -29.686), (-25.563, -28.795), (-25.055, -27.943), (-24.479, -27.135),
                        (-23.838, -26.379), (-23.136, -25.677),
                        (-22.380, -25.036), (-21.572, -24.460), (-20.720, -23.952), (-19.829, -23.517),
                        (-18.905, -23.156), (-17.955, -22.873), (-16.984, -22.670), (-16.000, -22.547),
                        (-15.009, -22.506), (-3.979, -22.506),
                        (-3.593, -22.468), (-3.221, -22.355), (-2.879, -22.172), (-2.579, -21.926), (-2.333, -21.626),
                        (-2.150, -21.284), (-2.037, -20.912), (-2.000, -20.539), (-2.000, 0.000), (-4.000, 0.000),
                        (-4.000, -18.550), (-4.037, -18.930), (-4.148, -19.296), (-4.329, -19.633), (-4.571, -19.929),
                        (-4.867, -20.171), (-5.204, -20.352), (-5.570, -20.463), (-5.950, -20.500), (-15.010, -20.500),
                        (-16.056, -20.539), (-17.097, -20.656), (-18.125, -20.851), (-19.137, -21.122),
                        (-20.125, -21.468), (-21.084, -21.886), (-22.010, -22.376), (-22.896, -22.933),
                        (-23.739, -23.554), (-24.532, -24.237),
                        (-25.273, -24.978), (-25.956, -25.771), (-26.577, -26.614), (-27.134, -27.500),
                        (-27.624, -28.426), (-28.042, -29.385), (-28.388, -30.373), (-28.659, -31.385),
                        (-28.854, -32.413), (-28.971, -33.454),
                        (-29.010, -34.500), (-29.010, -64.800), (-28.971, -65.846), (-28.854, -66.887),
                        (-28.659, -67.915), (-28.388, -68.927), (-28.042, -69.915), (-27.624, -70.874),
                        (-27.134, -71.800), (-26.577, -72.686),
                        (-25.956, -73.529), (-25.273, -74.322), (-24.532, -75.063), (-23.739, -75.746),
                        (-22.896, -76.367), (-22.010, -76.924), (-21.084, -77.414), (-20.125, -77.832),
                        (-19.137, -78.178), (-18.125, -78.449),
                        (-17.097, -78.644), (-16.056, -78.761), (-15.010, -78.800), (15.290, -78.800)]

        modify_points_outer = [(x * 2.5, y * 2.5) for x, y in points_outer]
        modify_points_outer = [(x + pad_pos[0], y + pad_pos[1]) for x, y in modify_points_outer]

        poly_outer = gdspy.Polygon(modify_points_outer)

        poly = gdspy.boolean(poly_inner, poly_outer, 'or')

        poly.rotate(math.pi * orientation / 180, pad_pos)

        self.cell.add(poly)